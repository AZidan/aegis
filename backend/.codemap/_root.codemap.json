{
  "directory": "",
  "files": {
    "DATABASE_SCHEMA.md": {
      "hash": "abf76fc9c8a8",
      "indexed_at": "2026-02-10T00:52:07.849320+00:00",
      "language": "markdown",
      "lines": 660,
      "symbols": [
        {
          "docstring": "This document describes the complete database schema for the Aegis Platform, a multi-tenant AI Multi-Agent SaaS. The schema is designed with:",
          "lines": [
            8,
            17
          ],
          "name": "Overview",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "All tenant-scoped tables include a `tenantId` field with proper indexing:",
              "lines": [
                20,
                37
              ],
              "name": "1. Multi-Tenancy Strategy",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "Used for flexible schemas that evolve over time:",
                  "lines": [
                    40,
                    57
                  ],
                  "name": "JSONB Columns",
                  "type": "subsubsection"
                },
                {
                  "docstring": "All tables use UUID primary keys for: - **Distributed systems**: No ID collision across services - **Security**: Non-sequential IDs prevent enumeratio",
                  "lines": [
                    58,
                    63
                  ],
                  "name": "UUID Primary Keys",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Type-safe status fields with PostgreSQL enums: - `UserRole`, `TenantStatus`, `TenantPlan` - `AgentRole`, `AgentStatus`, `ModelTier`, `ThinkingMode` -",
                  "lines": [
                    64,
                    72
                  ],
                  "name": "Enum Types",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                38,
                72
              ],
              "name": "2. PostgreSQL-Specific Features",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "Used for parent-child relationships where child data should be deleted with parent:",
                  "lines": [
                    75,
                    84
                  ],
                  "name": "Cascade Delete (ON DELETE CASCADE)",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Used for audit trails where we want to preserve history even if referenced entity is deleted:",
                  "lines": [
                    85,
                    90
                  ],
                  "name": "Set Null (ON DELETE SET NULL)",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Used where deletion should be prevented if dependencies exist:",
                  "lines": [
                    91,
                    95
                  ],
                  "name": "Restrict (ON DELETE RESTRICT)",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                73,
                95
              ],
              "name": "3. Relationship Patterns",
              "type": "subsection"
            }
          ],
          "lines": [
            18,
            95
          ],
          "name": "Architecture Decisions",
          "type": "section"
        },
        {
          "children": [
            {
              "children": [
                {
                  "docstring": "Platform admins, tenant admins, and tenant members.",
                  "lines": [
                    100,
                    125
                  ],
                  "name": "1. Users",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Companies/organizations with isolated container environments.",
                  "lines": [
                    126,
                    150
                  ],
                  "name": "2. Tenants",
                  "type": "subsubsection"
                },
                {
                  "docstring": "AI agents deployed for tenants.",
                  "lines": [
                    151,
                    179
                  ],
                  "name": "3. Agents",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Marketplace skills for agents.",
                  "lines": [
                    180,
                    209
                  ],
                  "name": "4. Skills",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                98,
                209
              ],
              "name": "Core Tables (4)",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "JWT refresh token tracking for secure session management.",
                  "lines": [
                    212,
                    232
                  ],
                  "name": "5. RefreshTokens",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Tenant API keys for programmatic access.",
                  "lines": [
                    233,
                    254
                  ],
                  "name": "6. ApiKeys",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                210,
                254
              ],
              "name": "Authentication & Authorization (2)",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "Users belonging to a tenant (many-to-many relationship).",
                  "lines": [
                    257,
                    276
                  ],
                  "name": "7. TeamMembers",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Pending team invitations.",
                  "lines": [
                    277,
                    302
                  ],
                  "name": "8. TeamInvites",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                255,
                302
              ],
              "name": "Team Management (2)",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "Communication channels (Telegram, Slack, Web).",
                  "lines": [
                    305,
                    324
                  ],
                  "name": "9. AgentChannels",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Activity feed for agents.",
                  "lines": [
                    325,
                    345
                  ],
                  "name": "10. AgentActivities",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Performance metrics for agents.",
                  "lines": [
                    346,
                    364
                  ],
                  "name": "11. AgentMetrics",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                303,
                364
              ],
              "name": "Agent Channels & Activity (3)",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "Installed skills per agent (many-to-many).",
                  "lines": [
                    367,
                    386
                  ],
                  "name": "12. SkillInstallations",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                365,
                386
              ],
              "name": "Skill Installations (1)",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "Container health metrics (time-series data).",
                  "lines": [
                    389,
                    412
                  ],
                  "name": "13. ContainerHealth",
                  "type": "subsubsection"
                },
                {
                  "docstring": "Platform alerts for admins.",
                  "lines": [
                    413,
                    433
                  ],
                  "name": "14. Alerts",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                387,
                433
              ],
              "name": "Monitoring & Health (2)",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "Comprehensive audit trail for compliance.",
                  "lines": [
                    436,
                    472
                  ],
                  "name": "15. AuditLogs",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                434,
                472
              ],
              "name": "Audit & Compliance (1)",
              "type": "subsection"
            }
          ],
          "lines": [
            96,
            472
          ],
          "name": "Schema Overview",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "1. **Primary Keys**: UUID indexes on all tables 2. **Foreign Keys**: Indexes on all FK columns for join performance 3. **Unique Constraints**: email,",
              "lines": [
                475,
                483
              ],
              "name": "Index Strategy",
              "type": "subsection"
            },
            {
              "docstring": "For advanced JSONB queries, consider GIN indexes:",
              "lines": [
                484,
                500
              ],
              "name": "JSONB Optimization",
              "type": "subsection"
            },
            {
              "docstring": "1. **Tenant-scoped queries**: Always filter by tenantId first 2. **Status filtering**: Use enum indexes for fast status checks 3. **Time-series data**",
              "lines": [
                501,
                508
              ],
              "name": "Query Performance Tips",
              "type": "subsection"
            }
          ],
          "lines": [
            473,
            508
          ],
          "name": "Performance Optimization",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- **User passwords**: Hashed with bcrypt (handled in application layer) - **API keys**: Hashed before storage (like passwords) - **MFA secrets**: Encr",
              "lines": [
                511,
                517
              ],
              "name": "Password & Secret Storage",
              "type": "subsection"
            },
            {
              "docstring": "- **Audit logs**: Sensitive fields (passwords, tokens) masked in details JSONB - **Skill source code**: Only accessible to platform admins during revi",
              "lines": [
                518,
                523
              ],
              "name": "Sensitive Data Handling",
              "type": "subsection"
            },
            {
              "docstring": "- **Row-Level Security (RLS)**: Schema ready for PostgreSQL RLS policies - **Application-level**: tenantId filtering enforced in application queries -",
              "lines": [
                524,
                529
              ],
              "name": "Multi-Tenancy Isolation",
              "type": "subsection"
            },
            {
              "docstring": "- **Comprehensive logging**: All actions logged to audit_logs table - **Actor tracking**: User, agent, or system actions - **Target tracking**: What e",
              "lines": [
                530,
                536
              ],
              "name": "Audit Trail",
              "type": "subsection"
            }
          ],
          "lines": [
            509,
            536
          ],
          "name": "Security Considerations",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- **AuditLog**: 90 days - **ContainerHealth**: 24 hours (detailed) - **RefreshToken**: Until expiry (7 days) + 30 days - **TeamInvite**: Until accepta",
              "lines": [
                539,
                545
              ],
              "name": "Hot Storage (PostgreSQL)",
              "type": "subsection"
            },
            {
              "docstring": "- **AuditLog**: 1 year (compressed) - **ContainerHealth**: 30 days (aggregated)",
              "lines": [
                546,
                550
              ],
              "name": "Cold Storage (S3/Object Storage)",
              "type": "subsection"
            },
            {
              "docstring": "1. **Expired refresh tokens**: Daily cleanup of tokens past expiresAt + 30 days 2. **Expired team invites**: Daily cleanup of invites past expiresAt +",
              "lines": [
                551,
                557
              ],
              "name": "Cleanup Jobs (Scheduled)",
              "type": "subsection"
            }
          ],
          "lines": [
            537,
            557
          ],
          "name": "Data Retention & Archival",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "Run the migration file:",
              "lines": [
                560,
                572
              ],
              "name": "Initial Migration",
              "type": "subsection"
            },
            {
              "docstring": "1. **Never modify existing migrations** - Always create new migration files 2. **Test migrations on staging** - Validate data integrity before product",
              "lines": [
                573,
                584
              ],
              "name": "Future Schema Changes",
              "type": "subsection"
            }
          ],
          "lines": [
            558,
            584
          ],
          "name": "Migration Strategy",
          "type": "section"
        },
        {
          "lines": [
            585,
            613
          ],
          "name": "ER Diagram",
          "type": "section"
        },
        {
          "docstring": "This schema is fully aligned with API Contract v1.1.0:",
          "lines": [
            614,
            623
          ],
          "name": "API Contract Alignment",
          "type": "section"
        },
        {
          "docstring": "This schema uses Prisma 7 features:",
          "lines": [
            624,
            644
          ],
          "name": "Prisma 7 Configuration",
          "type": "section"
        },
        {
          "docstring": "1. **Start PostgreSQL**: Ensure database server is running 2. **Apply migration**: `npx prisma migrate deploy` 3. **Generate client**: `npx prisma gen",
          "lines": [
            645,
            661
          ],
          "name": "Next Steps",
          "type": "section"
        }
      ]
    },
    "ER_DIAGRAM.md": {
      "hash": "f089107a6390",
      "indexed_at": "2026-02-10T00:52:07.848136+00:00",
      "language": "markdown",
      "lines": 464,
      "symbols": [
        {
          "lines": [
            3,
            242
          ],
          "name": "Mermaid ER Diagram",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "| Parent | Child | Relationship | Delete Policy | |--------|-------|--------------|---------------| | Tenant | User | has members | CASCADE | | Tenant",
              "lines": [
                245,
                267
              ],
              "name": "One-to-Many (1:N) Relationships",
              "type": "subsection"
            },
            {
              "docstring": "| Entity A | Entity B | Junction Table | Notes | |----------|----------|----------------|-------| | Agent | Skill | SkillInstallation | Tracks install",
              "lines": [
                268,
                274
              ],
              "name": "Many-to-Many (M:N) Relationships",
              "type": "subsection"
            },
            {
              "children": [
                {
                  "docstring": "- `User.email` - Email must be unique across platform - `User.oauthProvider + oauthId` - OAuth identity must be unique - `Tenant.companyName` - Compan",
                  "lines": [
                    277,
                    287
                  ],
                  "name": "Unique Constraints (Business Logic)",
                  "type": "subsubsection"
                },
                {
                  "docstring": "All foreign keys use proper ON DELETE policies: - **CASCADE**: Child deleted when parent deleted (most relationships) - **SET NULL**: Reference set to",
                  "lines": [
                    288,
                    293
                  ],
                  "name": "Foreign Key Constraints (Referential Integrity)",
                  "type": "subsubsection"
                }
              ],
              "lines": [
                275,
                293
              ],
              "name": "Key Constraints",
              "type": "subsection"
            }
          ],
          "lines": [
            243,
            293
          ],
          "name": "Relationship Summary",
          "type": "section"
        },
        {
          "children": [
            {
              "lines": [
                296,
                306
              ],
              "name": "User Authentication Flow",
              "type": "subsection"
            },
            {
              "lines": [
                307,
                321
              ],
              "name": "Tenant Provisioning Flow",
              "type": "subsection"
            },
            {
              "lines": [
                322,
                336
              ],
              "name": "Agent Creation Flow",
              "type": "subsection"
            },
            {
              "lines": [
                337,
                351
              ],
              "name": "Skill Publishing Flow",
              "type": "subsection"
            },
            {
              "lines": [
                352,
                366
              ],
              "name": "Audit Trail Flow",
              "type": "subsection"
            }
          ],
          "lines": [
            294,
            366
          ],
          "name": "Data Flow Patterns",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "1. User (nullable for platform admins) 2. Agent 3. TeamMember 4. TeamInvite 5. ApiKey 6. ContainerHealth 7. Alert 8. AuditLog (nullable for platform-w",
              "lines": [
                369,
                378
              ],
              "name": "Tenant-Scoped Tables (with tenantId)",
              "type": "subsection"
            },
            {
              "docstring": "1. RefreshToken (user-scoped) 2. Skill (marketplace-wide) 3. SkillInstallation (agent-scoped via agent.tenantId) 4. AgentChannel (agent-scoped via age",
              "lines": [
                379,
                386
              ],
              "name": "Platform-Wide Tables (no tenantId)",
              "type": "subsection"
            },
            {
              "lines": [
                387,
                399
              ],
              "name": "Isolation Strategy",
              "type": "subsection"
            }
          ],
          "lines": [
            367,
            399
          ],
          "name": "Multi-Tenancy Isolation",
          "type": "section"
        },
        {
          "lines": [
            400,
            432
          ],
          "name": "Index Strategy Visual",
          "type": "section"
        },
        {
          "lines": [
            433,
            465
          ],
          "name": "Security Boundaries",
          "type": "section"
        }
      ]
    },
    "PRISMA7_SETUP.md": {
      "hash": "7aed1af0522b",
      "indexed_at": "2026-02-10T00:52:07.851503+00:00",
      "language": "markdown",
      "lines": 198,
      "symbols": [
        {
          "children": [
            {
              "lines": [
                13,
                17
              ],
              "name": "\u274c This Does NOT Work:",
              "type": "subsection"
            },
            {
              "lines": [
                18,
                24
              ],
              "name": "\u2705 This DOES Work (Prisma 7 Standard):",
              "type": "subsection"
            }
          ],
          "docstring": "This project uses **Prisma 7's modern `prisma-client` provider**, which requires direct imports from the generated output location.",
          "lines": [
            9,
            24
          ],
          "name": "Why Relative Imports?",
          "type": "section"
        },
        {
          "children": [
            {
              "lines": [
                27,
                39
              ],
              "name": "Schema (prisma/schema.prisma)",
              "type": "subsection"
            },
            {
              "lines": [
                40,
                49
              ],
              "name": "Config (prisma.config.ts)",
              "type": "subsection"
            },
            {
              "lines": [
                50,
                57
              ],
              "name": "Import Pattern",
              "type": "subsection"
            }
          ],
          "lines": [
            25,
            57
          ],
          "name": "Configuration",
          "type": "section"
        },
        {
          "docstring": "| Feature | `prisma-client` (New) | `prisma-client-js` (Old) | |---------|----------------------|--------------------------| | **Performance** | 3x fa",
          "lines": [
            58,
            70
          ],
          "name": "Why Use `prisma-client` Provider?",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- **3x faster queries** - No Rust-to-JavaScript bridge overhead - **90% smaller bundles** - Reduced deployment size - **Lower memory usage** - Better",
              "lines": [
                73,
                77
              ],
              "name": "1. **Performance** \u26a1",
              "type": "subsection"
            },
            {
              "docstring": "- Uses latest Prisma 7 architecture - `prisma-client-js` will be removed in future releases - Aligned with Prisma's long-term direction",
              "lines": [
                78,
                82
              ],
              "name": "2. **Future-Proof** \ud83d\udd2e",
              "type": "subsection"
            },
            {
              "docstring": "- Generated code location is obvious - No hidden node_modules magic - Easier to understand for new team members",
              "lines": [
                83,
                89
              ],
              "name": "3. **Explicit & Clear** \ud83d\udccd",
              "type": "subsection"
            }
          ],
          "lines": [
            71,
            89
          ],
          "name": "Benefits of This Setup",
          "type": "section"
        },
        {
          "lines": [
            90,
            113
          ],
          "name": "Common Commands",
          "type": "section"
        },
        {
          "docstring": "The `@prisma/client` package import **only works with the deprecated `prisma-client-js` provider**.",
          "lines": [
            114,
            135
          ],
          "name": "Why Not Use `@prisma/client` Import?",
          "type": "section"
        },
        {
          "docstring": "When new developers join:",
          "lines": [
            136,
            157
          ],
          "name": "Team Onboarding",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "**Solution:** Run `npx prisma generate`",
              "lines": [
                160,
                165
              ],
              "name": "\"Module not found: prisma/generated/client\"",
              "type": "subsection"
            },
            {
              "docstring": "**Solution:** 1. Delete `prisma/generated/` folder 2. Run `npx prisma generate` 3. Rebuild: `npm run build`",
              "lines": [
                166,
                172
              ],
              "name": "\"Property '$connect' does not exist\"",
              "type": "subsection"
            },
            {
              "docstring": "**Solution:**",
              "lines": [
                173,
                182
              ],
              "name": "Type errors after schema changes",
              "type": "subsection"
            }
          ],
          "lines": [
            158,
            182
          ],
          "name": "Troubleshooting",
          "type": "section"
        },
        {
          "docstring": "- [Prisma 7 Upgrade Guide](https://www.prisma.io/docs/orm/more/upgrade-guides/upgrading-versions/upgrading-to-prisma-7) - [Generators Reference](https",
          "lines": [
            183,
            190
          ],
          "name": "References",
          "type": "section"
        },
        {
          "docstring": "\u2705 **This is the correct Prisma 7 setup** \u2705 **Relative imports are the standard for `prisma-client` provider** \u2705 **We get 3x performance improvement an",
          "lines": [
            191,
            199
          ],
          "name": "Summary",
          "type": "section"
        }
      ]
    },
    "PROJECT_STRUCTURE.md": {
      "hash": "483fa269576c",
      "indexed_at": "2026-02-10T00:52:07.847553+00:00",
      "language": "markdown",
      "lines": 434,
      "symbols": [
        {
          "lines": [
            8,
            89
          ],
          "name": "Directory Tree",
          "type": "section"
        },
        {
          "docstring": "| Type | Count | Purpose | |------|-------|---------| | TypeScript (.ts) | 19 | Application source code | | Configuration | 10 | Build, lint, format,",
          "lines": [
            90,
            103
          ],
          "name": "File Count by Type",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- `src/main.ts` - Application bootstrap - `src/app.module.ts` - Root module configuration - `src/app.controller.ts` - Health check endpoint - `src/app",
              "lines": [
                106,
                111
              ],
              "name": "1. Core Application (4 files)",
              "type": "subsection"
            },
            {
              "docstring": "- `src/auth/auth.module.ts` - Auth module config - `src/auth/auth.controller.ts` - Auth endpoints - `src/auth/auth.service.ts` - Auth business logic -",
              "lines": [
                112,
                120
              ],
              "name": "2. Authentication Module (8 items)",
              "type": "subsection"
            },
            {
              "docstring": "- `src/admin/admin.module.ts` - Admin root module - `src/admin/dashboard/dashboard.module.ts` - Dashboard submodule - `src/admin/dashboard/dashboard.c",
              "lines": [
                121,
                127
              ],
              "name": "3. Admin Module (6 items)",
              "type": "subsection"
            },
            {
              "docstring": "- `src/common/filters/http-exception.filter.ts` - Error handling - `src/common/interceptors/logging.interceptor.ts` - Request logging - `src/common/pi",
              "lines": [
                128,
                134
              ],
              "name": "4. Common Module (6 items)",
              "type": "subsection"
            },
            {
              "docstring": "- `src/config/configuration.ts` - Env loader - `src/config/validation.ts` - Env validation",
              "lines": [
                135,
                138
              ],
              "name": "5. Configuration Module (2 files)",
              "type": "subsection"
            },
            {
              "docstring": "- `src/prisma/prisma.service.ts` - Prisma client - `src/prisma/prisma.module.ts` - Prisma module - `prisma/schema.prisma` - Database schema",
              "lines": [
                139,
                143
              ],
              "name": "6. Database Module (3 files)",
              "type": "subsection"
            },
            {
              "docstring": "- `test/app.e2e-spec.ts` - E2E tests - `test/jest-e2e.json` - Jest config",
              "lines": [
                144,
                149
              ],
              "name": "7. Testing (2 files)",
              "type": "subsection"
            }
          ],
          "lines": [
            104,
            149
          ],
          "name": "Module Breakdown",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "**Scripts (14):** - `start`, `start:dev`, `start:debug`, `start:prod` - Server execution - `build` - TypeScript compilation - `format` - Prettier form",
              "lines": [
                152,
                162
              ],
              "name": "package.json",
              "type": "subsection"
            },
            {
              "docstring": "**Key Settings:** - `strict: true` - All strict checks enabled - `target: ES2021` - Modern JavaScript - `module: commonjs` - Node.js compatibility - `",
              "lines": [
                163,
                170
              ],
              "name": "tsconfig.json",
              "type": "subsection"
            },
            {
              "docstring": "**Key Rules:** - `@typescript-eslint/no-explicit-any: error` - No `any` types - `@typescript-eslint/no-unused-vars: error` - No unused vars - `no-cons",
              "lines": [
                171,
                177
              ],
              "name": ".eslintrc.js",
              "type": "subsection"
            },
            {
              "docstring": "**Variables (32):** - Application: NODE_ENV, PORT, API_PREFIX - Database: DATABASE_URL - Redis: REDIS_HOST, REDIS_PORT, REDIS_PASSWORD - JWT: 4 variab",
              "lines": [
                178,
                190
              ],
              "name": ".env.example",
              "type": "subsection"
            }
          ],
          "lines": [
            150,
            190
          ],
          "name": "Key Configuration Files",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- `GET /api/health` - Service health status",
              "lines": [
                193,
                206
              ],
              "name": "Health Check \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Authentication (6 endpoints):** - `POST /api/auth/login` - `POST /api/auth/login/oauth` - `POST /api/auth/refresh` - `POST /api/auth/logout` - `POST",
              "lines": [
                207,
                222
              ],
              "name": "Placeholders (Stage 3)",
              "type": "subsection"
            }
          ],
          "lines": [
            191,
            222
          ],
          "name": "API Endpoints Implemented",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- `@nestjs/common`, `@nestjs/core`, `@nestjs/platform-express` - Framework - `@nestjs/config` - Configuration - `@nestjs/cache-manager` - Caching - `@",
              "lines": [
                225,
                231
              ],
              "name": "Core NestJS (7 packages)",
              "type": "subsection"
            },
            {
              "docstring": "- `@prisma/client` - Prisma ORM client - `prisma` - Prisma CLI",
              "lines": [
                232,
                235
              ],
              "name": "Database (2 packages)",
              "type": "subsection"
            },
            {
              "docstring": "- `passport` - Auth framework - `passport-jwt` - JWT strategy - `passport-google-oauth20` - Google OAuth - `passport-github2` - GitHub OAuth - `bcrypt",
              "lines": [
                236,
                242
              ],
              "name": "Authentication (5 packages)",
              "type": "subsection"
            },
            {
              "docstring": "- `speakeasy` - TOTP generation - `qrcode` - QR code generation",
              "lines": [
                243,
                246
              ],
              "name": "MFA (2 packages)",
              "type": "subsection"
            },
            {
              "docstring": "- `class-validator` - DTO validation - `class-transformer` - DTO transformation - `zod` - Schema validation",
              "lines": [
                247,
                251
              ],
              "name": "Validation (3 packages)",
              "type": "subsection"
            },
            {
              "docstring": "- `ioredis` - Redis client - `cache-manager-ioredis-yet` - Cache manager",
              "lines": [
                252,
                255
              ],
              "name": "Redis (2 packages)",
              "type": "subsection"
            },
            {
              "docstring": "- `uuid` - UUID generation - `reflect-metadata` - Decorators - `rxjs` - Reactive programming",
              "lines": [
                256,
                260
              ],
              "name": "Utilities (3 packages)",
              "type": "subsection"
            },
            {
              "docstring": "- `@nestjs/cli` - NestJS CLI - `typescript` - TypeScript compiler - `eslint`, `prettier` - Code quality - `jest`, `supertest` - Testing - `@types/*` -",
              "lines": [
                261,
                269
              ],
              "name": "Development (14 packages)",
              "type": "subsection"
            }
          ],
          "lines": [
            223,
            269
          ],
          "name": "Dependencies Overview",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- All strict flags enabled - No `any` types allowed - Proper null checking - Explicit return types",
              "lines": [
                272,
                277
              ],
              "name": "TypeScript Strict Mode \u2705",
              "type": "subsection"
            },
            {
              "docstring": "- 7 strict rules enforced - No console.log (use Logger) - No unused variables - Proper async/await handling",
              "lines": [
                278,
                283
              ],
              "name": "ESLint \u2705",
              "type": "subsection"
            },
            {
              "docstring": "- Consistent formatting - Single quotes - 2 space indentation - 100 character line width - Trailing commas",
              "lines": [
                284,
                290
              ],
              "name": "Prettier \u2705",
              "type": "subsection"
            },
            {
              "docstring": "- Jest unit testing configured - E2E testing configured - Health check test implemented - Coverage reporting enabled",
              "lines": [
                291,
                298
              ],
              "name": "Testing \u2705",
              "type": "subsection"
            }
          ],
          "lines": [
            270,
            298
          ],
          "name": "Code Quality Metrics",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- \u2705 Environment variable validation - \u2705 Secrets in .env only - \u2705 Standard error format (no info leakage) - \u2705 CORS configuration - \u2705 Input validation p",
              "lines": [
                301,
                308
              ],
              "name": "Implemented \u2705",
              "type": "subsection"
            },
            {
              "docstring": "- \u2705 JWT configured - \u2705 bcrypt ready (12 rounds) - \u2705 MFA utilities installed - \u2705 OAuth providers configured - \u2705 Password validation ready - \u2705 Role-base",
              "lines": [
                309,
                318
              ],
              "name": "Ready for Stage 3 \u2705",
              "type": "subsection"
            }
          ],
          "lines": [
            299,
            318
          ],
          "name": "Security Features",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- Quick start guide - Prerequisites - Environment setup - Available scripts - Project structure - API documentation reference - Development guidelines",
              "lines": [
                321,
                332
              ],
              "name": "README.md (Comprehensive)",
              "type": "subsection"
            },
            {
              "docstring": "- Stage 1 completion report - All deliverables listed - Acceptance criteria status - Next steps (Stage 2) - File summary",
              "lines": [
                333,
                339
              ],
              "name": "SETUP_COMPLETE.md",
              "type": "subsection"
            },
            {
              "docstring": "- Complete directory tree - File count by type - Module breakdown - Configuration overview - Dependencies overview - Code quality metrics",
              "lines": [
                340,
                349
              ],
              "name": "PROJECT_STRUCTURE.md (This File)",
              "type": "subsection"
            }
          ],
          "lines": [
            319,
            349
          ],
          "name": "Documentation",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "**Deliverables:** - Complete Prisma schema with all models - Database migrations - Seed data (platform admin) - Schema documentation",
              "lines": [
                352,
                366
              ],
              "name": "Stage 2: Database Schema (Next)",
              "type": "subsection"
            },
            {
              "docstring": "**Deliverables:** - JWT authentication - OAuth2 (Google, GitHub) - MFA (TOTP) - Role-based access control - 6 auth endpoints - Guards and decorators",
              "lines": [
                367,
                375
              ],
              "name": "Stage 3: Authentication (Sprint 1)",
              "type": "subsection"
            },
            {
              "docstring": "**Deliverables:** - Dashboard statistics - Alert system - Real-time updates",
              "lines": [
                376,
                383
              ],
              "name": "Stage 4: Platform Admin Dashboard",
              "type": "subsection"
            }
          ],
          "lines": [
            350,
            383
          ],
          "name": "Next Stages",
          "type": "section"
        },
        {
          "lines": [
            384,
            413
          ],
          "name": "Commands Quick Reference",
          "type": "section"
        },
        {
          "docstring": "| Item | Status | Notes | |------|--------|-------| | Project Structure | \u2705 Complete | All directories created | | Dependencies | \u2705 Installed | 32 pac",
          "lines": [
            414,
            435
          ],
          "name": "Status Summary",
          "type": "section"
        }
      ]
    },
    "README.md": {
      "hash": "ace3d457887b",
      "indexed_at": "2026-02-10T00:52:07.850641+00:00",
      "language": "markdown",
      "lines": 358,
      "symbols": [
        {
          "docstring": "- **Framework**: NestJS 10+ - **Language**: TypeScript (strict mode) - **Database**: PostgreSQL 16+ (Prisma ORM 7) - **Cache/Sessions**: Redis 7+ - **",
          "lines": [
            5,
            14
          ],
          "name": "Tech Stack",
          "type": "section"
        },
        {
          "docstring": "- Node.js 20+ LTS - PostgreSQL 16+ (or 14+) - Redis 7+ - npm or yarn",
          "lines": [
            15,
            21
          ],
          "name": "Prerequisites",
          "type": "section"
        },
        {
          "children": [
            {
              "lines": [
                24,
                29
              ],
              "name": "1. Install Dependencies",
              "type": "subsection"
            },
            {
              "docstring": "Copy `.env.example` to `.env` and update the values:",
              "lines": [
                30,
                53
              ],
              "name": "2. Environment Setup",
              "type": "subsection"
            },
            {
              "lines": [
                54,
                66
              ],
              "name": "3. Database Setup",
              "type": "subsection"
            },
            {
              "lines": [
                67,
                76
              ],
              "name": "4. Start Development Server",
              "type": "subsection"
            }
          ],
          "lines": [
            22,
            76
          ],
          "name": "Quick Start",
          "type": "section"
        },
        {
          "children": [
            {
              "lines": [
                79,
                86
              ],
              "name": "Development",
              "type": "subsection"
            },
            {
              "lines": [
                87,
                93
              ],
              "name": "Build",
              "type": "subsection"
            },
            {
              "lines": [
                94,
                101
              ],
              "name": "Code Quality",
              "type": "subsection"
            },
            {
              "lines": [
                102,
                110
              ],
              "name": "Testing",
              "type": "subsection"
            },
            {
              "lines": [
                111,
                119
              ],
              "name": "Database",
              "type": "subsection"
            }
          ],
          "lines": [
            77,
            119
          ],
          "name": "Available Scripts",
          "type": "section"
        },
        {
          "lines": [
            120,
            162
          ],
          "name": "Project Structure",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "**Authentication:** - `POST /api/auth/login` - Email/password login - `POST /api/auth/login/oauth` - OAuth login (Google/GitHub) - `POST /api/auth/ref",
              "lines": [
                167,
                190
              ],
              "name": "Key Endpoints",
              "type": "subsection"
            },
            {
              "docstring": "All errors follow this standard format:",
              "lines": [
                191,
                208
              ],
              "name": "Error Response Format",
              "type": "subsection"
            }
          ],
          "docstring": "API Contract (Single Source of Truth): `../docs/api-contract.md`",
          "lines": [
            163,
            208
          ],
          "name": "API Documentation",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "This project uses TypeScript strict mode. Key rules:",
              "lines": [
                211,
                219
              ],
              "name": "TypeScript Strict Mode",
              "type": "subsection"
            },
            {
              "docstring": "1. **ESLint + Prettier**: Enforced on commit 2. **No console.log**: Use Logger instead 3. **Error handling**: Catch and format all errors 4. **Validat",
              "lines": [
                220,
                227
              ],
              "name": "Code Quality Standards",
              "type": "subsection"
            },
            {
              "docstring": "- \u2705 Input validation on ALL endpoints - \u2705 SQL injection prevention (Prisma ORM) - \u2705 XSS prevention (sanitize outputs) - \u2705 CSRF protection - \u2705 Rate lim",
              "lines": [
                228,
                238
              ],
              "name": "Security Best Practices",
              "type": "subsection"
            }
          ],
          "lines": [
            209,
            238
          ],
          "name": "Development Guidelines",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- [x] NestJS project initialized - [x] All dependencies installed - [x] TypeScript strict mode configured - [x] ESLint + Prettier configured - [x] Env",
              "lines": [
                241,
                252
              ],
              "name": "Stage 1: Project Setup \u2705 Complete",
              "type": "subsection"
            },
            {
              "docstring": "- [ ] Design complete Prisma schema - [ ] Create database migrations - [ ] Seed initial data",
              "lines": [
                253,
                258
              ],
              "name": "Stage 2: Database Schema (Next)",
              "type": "subsection"
            },
            {
              "docstring": "- [ ] Implement JWT authentication - [ ] Implement OAuth2 (Google, GitHub) - [ ] Implement MFA (TOTP) - [ ] Implement role-based access control - [ ]",
              "lines": [
                259,
                266
              ],
              "name": "Stage 3: Authentication (Sprint 1)",
              "type": "subsection"
            }
          ],
          "lines": [
            239,
            266
          ],
          "name": "Current Status",
          "type": "section"
        },
        {
          "docstring": "| Variable | Required | Default | Description | |----------|----------|---------|-------------| | `NODE_ENV` | No | `development` | Environment (devel",
          "lines": [
            267,
            291
          ],
          "name": "Environment Variables Reference",
          "type": "section"
        },
        {
          "children": [
            {
              "lines": [
                294,
                306
              ],
              "name": "Database Connection Issues",
              "type": "subsection"
            },
            {
              "lines": [
                307,
                320
              ],
              "name": "Redis Connection Issues",
              "type": "subsection"
            },
            {
              "lines": [
                321,
                333
              ],
              "name": "Port Already in Use",
              "type": "subsection"
            },
            {
              "lines": [
                334,
                342
              ],
              "name": "TypeScript Compilation Errors",
              "type": "subsection"
            }
          ],
          "lines": [
            292,
            342
          ],
          "name": "Troubleshooting",
          "type": "section"
        },
        {
          "docstring": "1. Follow TypeScript strict mode 2. Run linting before commit: `npm run lint` 3. Format code: `npm run format` 4. Write tests for new features 5. Foll",
          "lines": [
            343,
            351
          ],
          "name": "Contributing",
          "type": "section"
        },
        {
          "docstring": "For issues or questions, contact the development team.",
          "lines": [
            352,
            355
          ],
          "name": "Support",
          "type": "section"
        },
        {
          "docstring": "Proprietary - Aegis Platform \u00a9 2026",
          "lines": [
            356,
            359
          ],
          "name": "License",
          "type": "section"
        }
      ]
    },
    "SETUP_COMPLETE.md": {
      "hash": "ef23d75bf1b1",
      "indexed_at": "2026-02-10T00:52:07.850107+00:00",
      "language": "markdown",
      "lines": 489,
      "symbols": [
        {
          "children": [
            {
              "docstring": "Complete NestJS project structure created in `backend/` directory:",
              "lines": [
                11,
                69
              ],
              "name": "1. Project Structure \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Production Dependencies (18):** - `@nestjs/common`, `@nestjs/core`, `@nestjs/platform-express` (^11.1.13) - `@nestjs/config` (^4.0.3) - Environment",
              "lines": [
                70,
                100
              ],
              "name": "2. Dependencies Installed \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Configuration (`tsconfig.json`):** - \u2705 `strict: true` - \u2705 `strictNullChecks: true` - \u2705 `noImplicitAny: true` - \u2705 `strictBindCallApply: true` - \u2705 `fo",
              "lines": [
                101,
                112
              ],
              "name": "3. TypeScript Strict Mode \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**ESLint Rules (`.eslintrc.js`):** - \u2705 `@typescript-eslint/no-explicit-any: error` - No `any` types allowed - \u2705 `@typescript-eslint/no-unused-vars: er",
              "lines": [
                113,
                128
              ],
              "name": "4. ESLint + Prettier Configuration \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Template (`.env.example`):**",
              "lines": [
                129,
                164
              ],
              "name": "5. Environment Variables \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Schema (`prisma/schema.prisma`):** - \u2705 Generator configured (prisma-client-js) - \u2705 Datasource configured (PostgreSQL with Prisma 7) - \u2705 Placeholder",
              "lines": [
                165,
                182
              ],
              "name": "6. Prisma Initialized \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Authentication Module (`src/auth/`):** - \u2705 `auth.module.ts` - JWT + Passport configuration - \u2705 `auth.controller.ts` - Placeholder for 6 endpoints -",
              "lines": [
                183,
                207
              ],
              "name": "7. Base Modules Created \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Implementation:** - \u2705 `GET /api/health` - Returns service status - \u2705 Response includes: status, timestamp, environment, version, service name - \u2705 Co",
              "lines": [
                208,
                227
              ],
              "name": "8. Health Check Endpoint \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Comprehensive setup guide created:** - \u2705 Tech stack overview - \u2705 Prerequisites - \u2705 Quick start (4 steps) - \u2705 Available scripts (18 commands) - \u2705 Pro",
              "lines": [
                228,
                243
              ],
              "name": "9. README.md \u2705",
              "type": "subsection"
            },
            {
              "docstring": "**Build Configuration:** - \u2705 TypeScript compilation configured - \u2705 NestJS build system configured - \u2705 Jest testing configured - \u2705 E2E testing configur",
              "lines": [
                244,
                267
              ],
              "name": "10. Project Builds Successfully \u2705",
              "type": "subsection"
            }
          ],
          "lines": [
            9,
            267
          ],
          "name": "\u2705 Deliverables Completed",
          "type": "section"
        },
        {
          "docstring": "| Criteria | Status | Notes | |----------|--------|-------| | `npm install` completes without errors | \u2705 | All dependencies installed | | `npm run bui",
          "lines": [
            268,
            282
          ],
          "name": "\ud83d\udcca Acceptance Criteria Status",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- \u2705 Environment variable validation (Zod) - \u2705 ConfigModule (global, validated) - \u2705 Redis cache configuration - \u2705 CORS configuration (from env)",
              "lines": [
                285,
                290
              ],
              "name": "Global Configuration",
              "type": "subsection"
            },
            {
              "docstring": "- \u2705 Validation pipe (class-validator + transform) - \u2705 HTTP exception filter (API contract error format) - \u2705 Logging interceptor (request/response timi",
              "lines": [
                291,
                295
              ],
              "name": "Global Middleware",
              "type": "subsection"
            },
            {
              "docstring": "- \u2705 JWT module configured - \u2705 Passport module integrated - \u2705 bcrypt ready (12 rounds) - \u2705 MFA utilities (speakeasy, qrcode) - \u2705 UUID generation - \u2705 Se",
              "lines": [
                296,
                303
              ],
              "name": "Security Foundations",
              "type": "subsection"
            },
            {
              "docstring": "- \u2705 Prisma ORM configured - \u2705 PostgreSQL datasource (Prisma 7 configuration) - \u2705 Prisma service with lifecycle hooks - \u2705 Global Prisma module - \u2705 Sche",
              "lines": [
                304,
                310
              ],
              "name": "Database Foundation",
              "type": "subsection"
            },
            {
              "docstring": "- \u2705 Jest unit testing configured - \u2705 Jest E2E testing configured - \u2705 Health check E2E test - \u2705 Coverage reporting configured",
              "lines": [
                311,
                318
              ],
              "name": "Testing Foundation",
              "type": "subsection"
            }
          ],
          "lines": [
            283,
            318
          ],
          "name": "\ud83c\udfaf Key Features Implemented",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- Database models (Users, Tenants, Agents, Skills, etc.) - Migrations - Seed data",
              "lines": [
                323,
                327
              ],
              "name": "\u274c Stage 2 - Database Schema",
              "type": "subsection"
            },
            {
              "docstring": "- `POST /api/auth/login` - `POST /api/auth/login/oauth` - `POST /api/auth/refresh` - `POST /api/auth/logout` - `POST /api/auth/mfa/verify` - `GET /api",
              "lines": [
                328,
                335
              ],
              "name": "\u274c Stage 3 - Authentication Endpoints",
              "type": "subsection"
            },
            {
              "docstring": "- JWT strategies - OAuth strategies (Google, GitHub) - Guards (JWT, roles) - Decorators (@CurrentUser, @Roles, @Public) - MFA setup/verification logic",
              "lines": [
                336,
                343
              ],
              "name": "\u274c Stage 3 - Auth Implementation",
              "type": "subsection"
            },
            {
              "docstring": "- Dashboard statistics calculation - Alert generation - Tenant management - Agent management - Skill marketplace - Team management",
              "lines": [
                344,
                353
              ],
              "name": "\u274c Stage 3 - Business Logic",
              "type": "subsection"
            }
          ],
          "docstring": "Following Stage 1 requirements, the following will be implemented in later stages:",
          "lines": [
            319,
            353
          ],
          "name": "\ud83d\udeab What Was NOT Implemented (As Designed)",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "**Priority 1: Core Tables** 1. Users (platform admins, tenant admins, members) 2. Tenants (companies/organizations) 3. RefreshTokens (JWT refresh toke",
              "lines": [
                356,
                384
              ],
              "name": "Immediate Next Stage: Database Schema Design",
              "type": "subsection"
            }
          ],
          "lines": [
            354,
            384
          ],
          "name": "\ud83d\udd04 Next Steps (Stage 2)",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- `src/main.ts` - `src/app.module.ts` - `src/app.controller.ts` - `src/app.service.ts` - `src/auth/auth.module.ts` - `src/auth/auth.controller.ts` - `",
              "lines": [
                389,
                409
              ],
              "name": "Source Files (19 .ts files)",
              "type": "subsection"
            },
            {
              "docstring": "- `package.json` (with 14 scripts, 32 dependencies) - `tsconfig.json` (TypeScript strict mode) - `.eslintrc.js` (strict linting rules) - `.prettierrc`",
              "lines": [
                410,
                421
              ],
              "name": "Configuration Files (10)",
              "type": "subsection"
            },
            {
              "docstring": "- `README.md` (comprehensive setup guide) - `SETUP_COMPLETE.md` (this document) - 6 `.gitkeep` files (placeholder directories)",
              "lines": [
                422,
                428
              ],
              "name": "Documentation Files (3)",
              "type": "subsection"
            }
          ],
          "docstring": "**Total Files Created/Configured: 38**",
          "lines": [
            385,
            428
          ],
          "name": "\ud83d\udcc1 File Summary",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "1. **Check dependencies:**",
              "lines": [
                431,
                457
              ],
              "name": "Verify Setup",
              "type": "subsection"
            },
            {
              "docstring": "1. Read API contract for all data models 2. Design complete Prisma schema 3. Create initial migration 4. Generate Prisma Client 5. Seed platform admin",
              "lines": [
                458,
                465
              ],
              "name": "Start Stage 2 (Database Schema)",
              "type": "subsection"
            },
            {
              "docstring": "1. Implement JWT authentication 2. Implement OAuth strategies 3. Create guards and decorators 4. Implement auth endpoints 5. Write tests for auth flow",
              "lines": [
                466,
                475
              ],
              "name": "Start Stage 3 (Authentication)",
              "type": "subsection"
            }
          ],
          "lines": [
            429,
            475
          ],
          "name": "\ud83d\ude80 How to Proceed",
          "type": "section"
        },
        {
          "docstring": "**Status:** Production-ready backend foundation **Quality:** Enterprise-grade TypeScript, strict linting, comprehensive error handling **API Complianc",
          "lines": [
            476,
            490
          ],
          "name": "\u2705 Stage 1 Complete",
          "type": "section"
        }
      ]
    },
    "STAGE_2_COMPLETION.md": {
      "hash": "1ed2cce3ee70",
      "indexed_at": "2026-02-10T00:52:07.851180+00:00",
      "language": "markdown",
      "lines": 355,
      "symbols": [
        {
          "children": [
            {
              "docstring": "**File**: `prisma/schema.prisma`",
              "lines": [
                10,
                20
              ],
              "name": "1. Complete Prisma Schema",
              "type": "subsection"
            },
            {
              "docstring": "**File**: `prisma/migrations/20260206_initial_schema/migration.sql`",
              "lines": [
                21,
                30
              ],
              "name": "2. Migration File",
              "type": "subsection"
            },
            {
              "docstring": "**Directory**: `prisma/generated/`",
              "lines": [
                31,
                38
              ],
              "name": "3. Generated Prisma Client",
              "type": "subsection"
            },
            {
              "docstring": "**File**: `DATABASE_SCHEMA.md`",
              "lines": [
                39,
                53
              ],
              "name": "4. Schema Documentation",
              "type": "subsection"
            }
          ],
          "lines": [
            8,
            53
          ],
          "name": "Deliverables Completed",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "**Core Models (4):** 1. User - Platform admins, tenant admins, tenant members 2. Tenant - Companies/organizations 3. Agent - AI agents for tenants 4.",
              "lines": [
                56,
                86
              ],
              "name": "Models (15 tables)",
              "type": "subsection"
            },
            {
              "docstring": "- UserRole (3 values) - TenantStatus (4 values) - TenantPlan (3 values) - AgentRole (4 values) - AgentStatus (5 values) - ModelTier (3 values) - Think",
              "lines": [
                87,
                105
              ],
              "name": "Enums (12 types)",
              "type": "subsection"
            },
            {
              "docstring": "- 15 primary key indexes (UUID) - 25 foreign key indexes - 8 unique constraint indexes - 6 composite indexes",
              "lines": [
                106,
                111
              ],
              "name": "Indexes (54 total)",
              "type": "subsection"
            },
            {
              "docstring": "1. `agents.toolPolicy` - Tool access rules 2. `agents.assistedUser` - Role-based configuration 3. `tenants.modelDefaults` - Default model settings 4.",
              "lines": [
                112,
                123
              ],
              "name": "JSONB Columns (10 flexible schemas)",
              "type": "subsection"
            }
          ],
          "lines": [
            54,
            123
          ],
          "name": "Schema Statistics",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "**User Type:** - id, email, name, role \u2705 - tenantId (nullable for platform_admin) \u2705 - permissions (computed from role) \u2705 - createdAt \u2705",
              "lines": [
                126,
                149
              ],
              "name": "\u2705 All Types Match Exactly",
              "type": "subsection"
            },
            {
              "docstring": "**UserRole:** platform_admin, tenant_admin, tenant_member \u2705 **TenantStatus:** active, suspended, provisioning, failed \u2705 **TenantPlan:** starter, growt",
              "lines": [
                150,
                160
              ],
              "name": "\u2705 All Enum Values Match",
              "type": "subsection"
            }
          ],
          "lines": [
            124,
            160
          ],
          "name": "API Contract Compliance",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- All tenant-scoped tables have `tenantId` field - All `tenantId` fields are indexed - CASCADE deletes configured for data cleanup - Schema prepared f",
              "lines": [
                163,
                168
              ],
              "name": "\u2705 Row-Level Security Ready",
              "type": "subsection"
            },
            {
              "docstring": "- Users can belong to one tenant (nullable for platform admins) - Agents scoped to single tenant - TeamMembers link users to tenants - AuditLogs track",
              "lines": [
                169,
                175
              ],
              "name": "\u2705 Data Isolation",
              "type": "subsection"
            }
          ],
          "lines": [
            161,
            175
          ],
          "name": "Multi-Tenancy Features",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- All tables use UUID for distributed ID generation - Non-sequential IDs prevent enumeration attacks - Suitable for horizontal scaling",
              "lines": [
                178,
                182
              ],
              "name": "\u2705 UUID Primary Keys",
              "type": "subsection"
            },
            {
              "docstring": "- Tool policies can evolve without schema changes - Agent configurations adapt to requirements - Skill permissions support fine-grained rules - Audit",
              "lines": [
                183,
                188
              ],
              "name": "\u2705 JSONB for Flexible Schemas",
              "type": "subsection"
            },
            {
              "docstring": "- All foreign keys indexed for join performance - Status fields indexed for filtering - Timestamps indexed for time-series queries - Composite indexes",
              "lines": [
                189,
                194
              ],
              "name": "\u2705 Strategic Indexing",
              "type": "subsection"
            }
          ],
          "lines": [
            176,
            194
          ],
          "name": "PostgreSQL Optimizations",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- Passwords hashed with bcrypt (application layer) - API keys hashed like passwords - MFA secrets encrypted (application layer) - Sensitive audit data",
              "lines": [
                197,
                202
              ],
              "name": "\u2705 Secure Storage",
              "type": "subsection"
            },
            {
              "docstring": "- Tenant deletion removes all tenant data - User deletion removes tokens and memberships - Agent deletion removes channels and activities - Safe casca",
              "lines": [
                203,
                208
              ],
              "name": "\u2705 Cascade Deletes",
              "type": "subsection"
            },
            {
              "docstring": "- All actions logged with actor tracking - Target tracking for affected entities - Network context (IP, user agent) - Severity classification - 90-day",
              "lines": [
                209,
                215
              ],
              "name": "\u2705 Audit Trail",
              "type": "subsection"
            }
          ],
          "lines": [
            195,
            215
          ],
          "name": "Security Features",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- Primary keys: UUID B-tree indexes - Foreign keys: All indexed for joins - Status fields: Enum indexes for filtering - Timestamps: Time-series query",
              "lines": [
                218,
                224
              ],
              "name": "\u2705 Index Strategy",
              "type": "subsection"
            },
            {
              "docstring": "- Tenant-scoped queries via tenantId index - Status filtering via enum indexes - Time-series via timestamp indexes - JSONB queries ready for GIN index",
              "lines": [
                225,
                230
              ],
              "name": "\u2705 Query Optimization Ready",
              "type": "subsection"
            },
            {
              "docstring": "- ContainerHealth: 24h detailed, 30d aggregated - AuditLog: 90d PostgreSQL, 1y S3 - RefreshToken: Auto-cleanup after expiry - TeamInvite: Auto-cleanup",
              "lines": [
                231,
                236
              ],
              "name": "\u2705 Data Retention",
              "type": "subsection"
            }
          ],
          "lines": [
            216,
            236
          ],
          "name": "Performance Features",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "- [x] `npx prisma validate` - PASSED \u2705 - [x] `npx prisma generate` - SUCCESS \u2705 - [x] `npx prisma format` - FORMATTED \u2705 - [x] TypeScript compilation -",
              "lines": [
                239,
                244
              ],
              "name": "Schema Validation",
              "type": "subsection"
            },
            {
              "docstring": "- [x] All Global Types present - [x] All enum values match - [x] All required fields present - [x] All relationships configured - [x] JSONB for flexib",
              "lines": [
                245,
                251
              ],
              "name": "API Contract Compliance",
              "type": "subsection"
            },
            {
              "docstring": "- [x] tenantId on all tenant tables - [x] All tenantId fields indexed - [x] CASCADE deletes configured - [x] RLS-ready schema structure",
              "lines": [
                252,
                257
              ],
              "name": "Multi-Tenancy",
              "type": "subsection"
            },
            {
              "docstring": "- [x] UUID primary keys - [x] Foreign key indexes - [x] Status field indexes - [x] Timestamp indexes - [x] Unique constraints",
              "lines": [
                258,
                264
              ],
              "name": "Performance",
              "type": "subsection"
            },
            {
              "docstring": "- [x] Password hashing support - [x] API key hashing support - [x] MFA secret storage - [x] Audit trail comprehensive - [x] Cascade delete safety",
              "lines": [
                265,
                271
              ],
              "name": "Security",
              "type": "subsection"
            }
          ],
          "lines": [
            237,
            271
          ],
          "name": "Validation Checklist",
          "type": "section"
        },
        {
          "children": [
            {
              "docstring": "1. **Start PostgreSQL Database**",
              "lines": [
                274,
                296
              ],
              "name": "Immediate (Stage 3 - Implementation)",
              "type": "subsection"
            },
            {
              "docstring": "1. **Row-Level Security (RLS)** - Implement PostgreSQL RLS policies - Tenant isolation at database level - Performance testing with RLS",
              "lines": [
                297,
                319
              ],
              "name": "Future Enhancements",
              "type": "subsection"
            }
          ],
          "lines": [
            272,
            319
          ],
          "name": "Next Steps",
          "type": "section"
        },
        {
          "lines": [
            320,
            334
          ],
          "name": "Files Generated",
          "type": "section"
        },
        {
          "docstring": "Stage 2 is **COMPLETE** with:",
          "lines": [
            335,
            356
          ],
          "name": "Summary",
          "type": "section"
        }
      ]
    }
  },
  "generated_at": "2026-02-10T00:52:07.903440+00:00",
  "version": "1.0"
}