# Current Feature Tracker
# Tracks active development scope and requirements per CLAUDE.md

feature:
  name: "Container Health Monitoring"
  epic: "E1-F5"
  sprint: "Sprint 2 - Control Plane Core"
  priority: P0
  started_at: "2026-02-07"
  completed_at: "2026-02-07"
  status: completed
  branch: health-monitoring (merged to master)

# Feature scope from roadmap E1-F5
requirements:
  - "Health check runs every 30 seconds against each tenant container"
  - "Health status includes: container up/down, memory, CPU, disk"
  - "Unhealthy containers trigger automatic restart (max 3 per hour)"
  - "Platform admin receives alert if container fails 3 consecutive checks"
  - "GET /api/admin/tenants/:id/health returns current status + 24h history"

# Design decisions (approved)
design_decisions:
  scheduling: "BullMQ (via Redis) - repeatable jobs"
  health_probe: "Pluggable interface - MockHealthProbe for MVP, DockerHealthProbe future"
  auto_restart: "Redis INCR + 1h TTL for restart counter, circuit breaker at 3"
  alerting: "DB only (Alert table) - no webhook/email for now"
  websocket: "Deferred to dashboard features (E2-F1/E2-F4)"
  data_retention: "Daily cleanup job deletes records >24h"

# Tasks
tasks:
  - name: "Backend Health Module (BullMQ + Monitoring)"
    branch: "health/backend-module"
    status: completed
    agent: api-engineer
    subtasks:
      - "1.1 Install BullMQ deps, configure in app.module"
      - "1.2 HealthProbeStrategy interface + MockHealthProbe"
      - "1.3 HealthMonitorService (evaluate, auto-restart, alerts)"
      - "1.4 HealthCheckProcessor (BullMQ worker, 30s schedule)"
      - "1.5 HealthCleanupProcessor (BullMQ worker, daily)"
      - "1.6 HealthModule registration + wiring"

  - name: "Tests"
    branch: "health/backend-module"
    status: completed
    agent: qa-engineer
    subtasks:
      - "2.1 Unit tests for HealthMonitorService (28 tests)"
      - "2.2 Unit tests for HealthCheckProcessor (11 tests)"
      - "2.3 Unit tests for MockHealthProbe (13 tests)"

# Results
results:
  files_created: 10
  files_modified: 3
  tests: 52
  test_suites: 3
  build: passing
  commit: "315236f"
  merged_to_master: true

# Acceptance criteria - ALL MET
acceptance_criteria:
  - "BullMQ configured with Redis connection [DONE]"
  - "Health check job runs every 30s for all active tenants [DONE]"
  - "HealthProbeStrategy interface with MockHealthProbe implementation [DONE]"
  - "Auto-restart triggers on 'down' status (max 3/hr via Redis counter) [DONE]"
  - "Alert created in DB after 3 consecutive failures [DONE]"
  - "Daily cleanup job removes health records >24h [DONE]"
  - "npm run build passes [DONE]"
  - "All 159 tests pass (52 health + 107 existing) [DONE]"
