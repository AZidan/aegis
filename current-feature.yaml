# Current Feature Tracker
# Tracks active development scope and requirements per CLAUDE.md

feature:
  name: "Container Provisioning"
  epic: "E1-F2"
  sprint: "Sprint 2 - Control Plane Core"
  priority: P0
  points: 13
  started_at: "2026-02-07"
  status: in_progress
  branch: container-provisioning

requirements:
  - "After tenant creation, provisioning job creates isolated container"
  - "5 provisioning steps: create namespace, spin container, configure, install skills, health check"
  - "Provisioning completes within 5 minutes or fails with clear error"
  - "Failed provisioning triggers retry (max 3 attempts) and alerts platform admin"
  - "3-step wizard UI: Company Details → Plan & Limits → Provision"
  - "Live provisioning progress with polling"

design_decisions:
  design_source: "design-artifacts/screens/tenant-provisioning.html"
  provisioning_engine: "BullMQ job processor (mock steps, replaceable with K8s later)"
  progress_tracking: "Poll GET /api/admin/tenants/:id every 2s during provisioning"
  websocket: "Deferred - use polling for MVP"

tasks:
  - name: "API Contract Update"
    status: in_progress
    subtasks:
      - "1.1 Add missing request fields (companySize, deploymentRegion, notes, billingCycle, maxSkills)"
      - "1.2 Add provisioning progress fields to tenant detail response"
      - "1.3 Bump version to v1.3.0"

  - name: "Backend Provisioning Module"
    branch: "container-provisioning/backend-provisioning"
    status: pending
    agent: api-engineer
    subtasks:
      - "2.1 Create ProvisioningModule (service + BullMQ processor)"
      - "2.2 Implement 5 mock provisioning steps with simulated delays"
      - "2.3 Track provisioning progress in DB"
      - "2.4 Add retry logic (max 3, exponential backoff) + Alert on failure"
      - "2.5 Wire createTenant() to enqueue provisioning job"
      - "2.6 Extend tenant detail response with provisioning step/progress"
      - "2.7 Prisma migration for new fields"
      - "2.8 Backend unit tests"

  - name: "Frontend Provisioning Wizard"
    branch: "container-provisioning/frontend-wizard"
    status: pending
    agent: ui-engineer
    subtasks:
      - "3.1 Wizard layout with 3-step stepper"
      - "3.2 Step 1: Company Details form"
      - "3.3 Step 2: Plan & Limits (plan cards, sliders, billing toggle)"
      - "3.4 Step 3: Summary + provisioning progress + success state"
      - "3.5 Bottom action bar"
      - "3.6 Wire to API"
      - "3.7 Frontend component tests"

  - name: "Integration Tests"
    branch: "container-provisioning/tests"
    status: pending
    agent: qa-engineer
    subtasks:
      - "4.1 E2E provisioning flow tests"
      - "4.2 Retry/failure scenarios"
      - "4.3 Build verification"

acceptance_criteria:
  - "POST /api/admin/tenants accepts all fields from design screen"
  - "Provisioning job runs 5 steps with progress tracking"
  - "Retry max 3 times on failure, creates Alert"
  - "Tenant detail returns provisioning step + progress %"
  - "3-step wizard matches tenant-provisioning.html design"
  - "Plan cards show Starter $99, Pro $299, Enterprise $799"
  - "Resource sliders for agents (1-50) and skills (5-200)"
  - "Live progress polling at 2s during provisioning"
  - "Success state shows tenant ID with copy button"
  - "npm run build passes for both frontend and backend"
  - "All tests pass"
