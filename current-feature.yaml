# Current Feature Tracker
# Tracks active development scope and requirements per CLAUDE.md

feature:
  name: "Container Health Monitoring"
  epic: "E1-F5"
  sprint: "Sprint 2 - Control Plane Core"
  priority: P0
  started_at: "2026-02-07"
  status: in_progress
  branch: health-monitoring

# Feature scope from roadmap E1-F5
requirements:
  - "Health check runs every 30 seconds against each tenant container"
  - "Health status includes: container up/down, memory, CPU, disk"
  - "Unhealthy containers trigger automatic restart (max 3 per hour)"
  - "Platform admin receives alert if container fails 3 consecutive checks"
  - "GET /api/admin/tenants/:id/health returns current status + 24h history"

# Design decisions (approved)
design_decisions:
  scheduling: "BullMQ (via Redis) - repeatable jobs"
  health_probe: "Pluggable interface - MockHealthProbe for MVP, DockerHealthProbe future"
  auto_restart: "Redis INCR + 1h TTL for restart counter, circuit breaker at 3"
  alerting: "DB only (Alert table) - no webhook/email for now"
  websocket: "Deferred to dashboard features (E2-F1/E2-F4)"
  data_retention: "Daily cleanup job deletes records >24h"

# Tasks
tasks:
  - name: "Backend Health Module (BullMQ + Monitoring)"
    branch: "health/backend-module"
    status: in_progress
    agent: api-engineer
    subtasks:
      - "1.1 Install BullMQ deps, configure in app.module"
      - "1.2 HealthProbeStrategy interface + MockHealthProbe"
      - "1.3 HealthMonitorService (evaluate, auto-restart, alerts)"
      - "1.4 HealthCheckProcessor (BullMQ worker, 30s schedule)"
      - "1.5 HealthCleanupProcessor (BullMQ worker, daily)"
      - "1.6 HealthModule registration + wiring"

  - name: "Tests"
    branch: "health/tests"
    status: pending
    agent: qa-engineer
    subtasks:
      - "2.1 Unit tests for HealthMonitorService"
      - "2.2 Unit tests for HealthCheckProcessor"
      - "2.3 Unit tests for MockHealthProbe"

# Agents
active_agents:
  - name: api-engineer
    task: "Implement health monitoring module with BullMQ"
    source_of_truth: "Design decisions above + docs/api-contract.md Section 3"

# Acceptance criteria
acceptance_criteria:
  - "BullMQ configured with Redis connection"
  - "Health check job runs every 30s for all active tenants"
  - "HealthProbeStrategy interface with MockHealthProbe implementation"
  - "Auto-restart triggers on 'down' status (max 3/hr via Redis counter)"
  - "Alert created in DB after 3 consecutive failures"
  - "Daily cleanup job removes health records >24h"
  - "npm run build passes"
  - "All tests pass"
